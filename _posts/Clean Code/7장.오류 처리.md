## ì œ 7ì¥. ì˜¤ë¥˜ ì²˜ë¦¬

### ğŸ“Œì˜¤ë¥˜ ì½”ë“œë³´ë‹¤ ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•˜ë¼

ì˜¤ë¥˜ ì½”ë“œ ì‚¬ìš©ì€ í˜¸ì¶œì ì½”ë“œê°€ ë³µì¡í•´ì§„ë‹¤.

ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ”ê²Œ ë‚«ë‹¤. 

```java
public void sendShutDown() {
	try {
		tryToShutDown();
	} catch (DeviceShutDownError e) {
		logger.log(e);
	}
}

private void tryToShutDown() throws DeviceShutDownError {
		DeviceHandle handle = getHandle(DEV1);
		DeviceRecord record = retrieveDeviceRecord(handle);
		pauseDevice(handle); 
		clearDeviceWorkQueue(handle); 
		closeDevice(handle);
}

private DeviceHandle getHandle(DeviceID id) {
    ...
	throw new DeviceShutDownError("Invalid handle for: " + id.toString());
    ...
}
```



### ğŸ“Œ Try-Catch-Finally ë¶€í„° ì‘ì„±í•˜ë¼

try ë¸”ë¡ì€ íŠ¸ëœì­ì…˜ê³¼ ë¹„ìŠ·í•˜ë‹¤. try ë¸”ë¡ì—ì„œ ë¬´ìŠ¨ ì¼ì´ ìƒê²¨ë„ catch ë¸”ë¡ì€ í”„ë¡œê·¸ë¨ ìƒíƒœë¥¼ ì¼ê´€ì„± ìˆê²Œ ìœ ì§€í•´ì•¼ í•œë‹¤. 

TDD ë°©ì‹ìœ¼ë¡œ ë©”ì†Œë“œ êµ¬í˜„

1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°

   ```java
    @Test(expected = StorageException.class)
    public void retrieveSectionShouldThrowOnInvalidFileName() {
        sectionStore.retrieveSection("invalid - file");
    }
   ```

   

2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì— ë§ì¶° ì½”ë“œ êµ¬í˜„

   ```java
    public List<RecordedGrip> retrieveSection(String sectionName) {
        // ì‹¤ì œë¡œ êµ¬í˜„í•  ë•Œê¹Œì§€ ë¹„ì–´ ìˆëŠ” ë”ë¯¸ë¥¼ ë°˜í™˜í•œë‹¤.
        return new ArrayList<RecordedGrip>();
    }
   ```

   

3. íŒŒì¼ ì ‘ê·¼ ì‹œë„í•˜ë„ë¡ ì½”ë“œ ìˆ˜ì •

   ```java
    public List<RecordedGrip> retrieveSection(String sectionName) {
        try {
            FileInputStream stream = new FileInputStream(sectionName);
        } catch (Exception e) {
            throw new StorageException("retrieval error", e);
        }
        return new ArrayList<RecordedGrip>();
    }
   ```

   

4. ë¦¬íŒ©í„°ë§ ê°€ëŠ¥

   ```java
    public List<RecordedGrip> retrieveSection(String sectionName) {
        try {
            FileInputStream stream = new FileInputStream(sectionName);
            stream.close();
        } catch (FileNotFoundException e) {
            throw new StorageException("retrieval error", e);
        }
        return new ArrayList<RecordedGrip>();
    }
   ```

   TDDë¥¼ ì‚¬ìš©í•´ í•„ìš”í•œ ë‚˜ë¨¸ì§€ ë…¼ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤. ë‚˜ë¨¸ì§€ ë…¼ë¦¬ëŠ” FileInputStreamì„ ìƒì„±í•˜ëŠ” ì½”ë“œì™€ closes í˜¸ì¶œë¬¸ ì‚¬ì´ì— ë„£ìœ¼ë©°, ì˜¤ë¥˜ë‚˜ ì˜ˆì™¸ê°€ ì „í˜€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ê°€ì •í•œë‹¤.


ì•„ë˜ì²˜ëŸ¼ í•˜ë©´ try ë¸”ë¡ì˜ íŠ¸ëœì­ì…˜ ë²”ìœ„ë¶€í„° êµ¬í˜„í•˜ê²Œ ë˜ì–´ ë²”ìœ„ ë‚´ì—ì„œ íŠ¸ëœì­ì…˜ ë³¸ì§ˆì„ ìœ ì§€í•˜ê¸°  ì‰¬ì›Œì§„ë‹¤.

- ë¨¼ì € ê°•ì œë¡œ ì˜ˆì™¸ë¥¼ ì¼ìœ¼í‚¤ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±
- í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±



### ğŸ“Œ ë¯¸í™•ì¸ ì˜ˆì™¸(unchecked)ë¥¼ ì‚¬ìš©í•˜ë¼

ìµœí•˜ìœ„ í•¨ìˆ˜ë¥¼ ë³€ê²½í•´ í™•ì¸ëœ ì˜ˆì™¸ë¥¼ ë˜ì§€ë©´ catch ë¸”ë¡ì—ì„œ ìƒˆë¡œìš´ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê±°ë‚˜, ì„ ì–¸ë¶€ì— throw ì ˆì„ ì¶”ê°€í•´ì•¼ í•œë‹¤. ë‹¨ê³„ë³„ë¡œ ì—°ì‡„ì ì¸ ìˆ˜ì •ì´ ì¼ì–´ë‚˜ê³  throw ê²½ë¡œì— ìœ„ì¹˜í•˜ëŠ” ëª¨ë“  í•¨ìˆ˜ê°€ ìµœí•˜ìœ„ í•¨ìˆ˜ì—ì„œ ë˜ì§€ëŠ” ì˜ˆì™¸ë¥¼ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ìº¡ìŠí™”ê°€ ê¹¨ì§„ë‹¤.

**Checked Exception**

- ë°˜ë“œì‹œ ì˜ˆì™¸ ì²˜ë¦¬ í•´ì•¼ í•¨
- Rollback ì•ˆë¨
- IOException, SQLException

```java
  private final ObjectMapper objectMapper = new ObjectMapper();

  // ì˜ˆì™¸ì²˜ë¦¬ë¥¼ throwsë¥¼ í†µí•´ì„œ ìœ„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  public String writeValueAsString(Object object) throws JsonProcessingException {
    return objectMapper.writeValueAsString(object);
  }

  // ì˜ˆì™¸ì²˜ë¦¬ë¥¼ throwsë¥¼ í†µí•´ì„œ ìœ„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  public <T> T readValue(String json, Class<T> clazz) throws IOException {
    return objectMapper.readValue(json, clazz);
  }

```



**UnChecked Exception**

- ì˜ˆì™¸ ì²˜ë¦¬ ì•ˆí•´ë„ ë¨
- Rollback ì§„í–‰
- NullPointerexception, IllegalArgumentException
- <u>**RuntimeException ìƒì†**</u>

```java
public String writeValueAsString(Object object) {
    try {
      return objectMapper.writeValueAsString(object);
    } catch (JsonProcessingException e) {
      throw new JsonSerializeFailed(e.getMessage());
    }
  }

  public <T> T readValue(String json, Class<T> clazz) {
    try {
      return objectMapper.readValue(json, clazz);
    } catch (IOException e) {
      throw new JsonDeserializeFailed(e.getMessage());
    }
  }
```



**Checked Exceptionì€ ì™œ Rollbackì´ ì•ˆë ê¹Œ?**

Checked Exceptionì€ ë³µêµ¬ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ë§¤ì»¤ë‹ˆì¦˜ì„ ê°€ì§€ê³  ìˆìŒ

í•˜ì§€ë§Œ Exceptionìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒë³´ë‹¤ ì½”ë“œ íë¦„ìœ¼ë¡œ ì œì–´í•˜ëŠ”ê²Œ ë” ì í•©í•˜ë‹¤.

ìœ ë‹ˆí¬í•œ ê°’ì´ ì¤‘ë³µë˜ì„œ SQLExceptionì´ ë°œìƒí•˜ëŠ” ê²½ìš°ëŠ” ë‚œìˆ˜ë¡œ ì†ŒìŠ¤ ë‚´ì—ì„œ insert ì²˜ë¦¬í•˜ë©´ ë˜ê² ì§€ë§Œ, í˜„ì‹¤ì ì¸ ë°©ë²•ì€ DuplicateEmailException(RuntimeException)ì„ ë°œìƒì‹œí‚¤ê³  ì…ë ¥ì„ ë‹¤ì‹œ ìœ ë„í•˜ëŠ” ê²ƒì´ë‹¤.

**Checked Exceptionì„ ë§Œë‚˜ë©´ ë” êµ¬ì²´ì ì¸ Unchecked Exceptionì„ ë°œìƒì‹œì¼œ ì •í™•í•œ ì •ë³´ ì „ë‹¬ ë° ë¡œì§ íë¦„ì„ ì œì–´í•´ì•¼ í•œë‹¤.**

ì°¸ê³ : https://cheese10yun.github.io/checked-exception/



### ğŸ“Œ ì˜ˆì™¸ì— ì˜ë¯¸ë¥¼ ì œê³µí•˜ë¼

ì˜ˆì™¸ë¥¼ ë˜ì§ˆ ë•ŒëŠ” ì „í›„ ìƒí™©ì„ ì¶©ë¶„íˆ ë§ë¶™ì¸ë‹¤. ê·¸ëŸ¬ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì›ì¸ê³¼ ìœ„ì¹˜ë¥¼ ì°¾ê¸° ì‰¬ì›Œì§„ë‹¤.

ì¦‰, ì˜¤ë¥˜ ë©”ì‹œì§€ì— ì •ë³´ë¥¼ ë‹´ì•„ ì˜ˆì™¸ì™€ í•¨ê»˜ ë˜ì§„ë‹¤. (ì‹¤íŒ¨í•œ ì—°ì‚° ì´ë¦„ ë° ì‹¤íŒ¨ ìœ í˜• ì–¸ê¸‰)


### ğŸ“Œ í˜¸ì¶œìë¥¼ ê³ ë ¤í•´ ì˜ˆì™¸ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ë¼

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜¤ë¥˜ ì •ì˜í•  ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ê´€ì‹¬ì‚¬ëŠ” **ì˜¤ë¥˜ë¥¼ ì¡ì•„ë‚´ëŠ” ë°©ë²•**ì´ ë˜ì•¼ í•œë‹¤.

**ì˜¤ë¥˜ë¥¼ í˜•í¸ì—†ì´ ë¶„ë¥˜í•œ ì‚¬ë¡€** 

```java
 ACMEPort port = new ACMEPort(12);

 try {
     port.open();
 } catch (DeviceResponseException e) {
     reportPortError(e);
     logger.log("Device response exception", e);
 } catch (ATM1212UnlockedException e) {
     reportPortError(e);
     logger.log("Unlock exception", e);
 } catch (GMXError e) {
     reportPortError(e);
     logger.log("Device response exception");
 } finally {
     ...
 }
```


**ê°œì„ **
í˜¸ì¶œë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ APIë¥¼ ê°ì‹¸ë©´ì„œ ì˜ˆì™¸ ìœ í˜• í•˜ë‚˜ë¥¼ ë°˜í™˜í•˜ë©´ ëœë‹¤. LocalPortëŠ” ACMEPort í´ë˜ìŠ¤ê°€ ë˜ì§€ëŠ” ì˜ˆì™¸ë¥¼ ì¡ì•„ ë³€í™˜í•˜ëŠ” Wrapper í´ë˜ìŠ¤ì´ë‹¤.

```java
LocalPort port = new LocalPort(12);
 try {
     port.open();
 } catch (PortDeviceFailure e) {
     reportError(e);
     logger.log(e.getMessage(), e);
 } finally {
     ...
 }


public class LocalPort {
     private ACMEPort innerPort;

     public LocalPort(int portNumber) {
         innerPort = new ACMEPort(portNumber);
     }

     public void open() {
         try {
             innerPort.open();
         } catch (DeviceResponseException e) {
             throw new PortDeviceFailure(e);
         } catch (ATM1212UnlockedException e) {
             throw new PortDeviceFailure(e);
         } catch (GMXError e) {
             throw new PortDeviceFailure(e);
         }
     }
     ...
}
```

ì™¸ë¶€ APIë¥¼ ì‚¬ìš©í• ë•Œ ê°ì‹¸ê¸° ë°©ë²•ì´ ìµœì„ ì´ë‹¤. 

- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í”„ë¡œê·¸ë¨ ì‚¬ì´ì—ì„œ ì˜ì¡´ì„±ì´ í¬ê²Œ ì¤„ì–´ë“ ë‹¤. 
- ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ê°ˆì•„íƒ€ë„ ë¹„ìš©ì´ ì ë‹¤. 
- í”„ë¡œê·¸ë¨ í…ŒìŠ¤íŠ¸ê°€ ì‰¬ì›Œì§„ë‹¤.
- ì™¸ë¶€ API ì„¤ê³„ ë°©ì‹ì— ì˜ì¡´í•˜ì§€ ì•Šì•„ë„ ë¨



### ğŸ“Œ ì •ìƒ íë¦„ì„ ì •ì˜í•˜ë¼

í´ë˜ìŠ¤ë‚˜ ê°ì²´ê°€ ì˜ˆì™¸ì ì¸ ìƒí™©ì„ ìº¡ìŠí™” ì²˜ë¦¬í•´ì„œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œê°€ ì˜ˆì™¸ì ì¸ ìƒí™©ì„ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

íŠ¹ìˆ˜ ì‚¬ë¡€ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” íŠ¹ìˆ˜ ì‚¬ë¡€ íŒ¨í„´ì˜ ì˜ˆì‹œ
ì²­êµ¬í•œ ì‹ë¹„ë¥¼ ì´ê³„ì— ë”í•˜ê³ , ì²­êµ¬í•œ ì‹ë¹„ê°€ ì—†ìœ¼ë©´ ì¼ì¼ ê¸°ë³¸ ì‹ë¹„ë¥¼ ë”í•œë‹¤.

```java
try {
     MealExpenses expenses = expenseReportDAO.getMeals(employee.getID());
     m_total += expenses.getTotal();
 } catch(MealExpencesNotFound e) {
     m_total += getMealPerDiem();
}
```

ì²­êµ¬í•œ ì‹ë¹„ê°€ ì—†ë‹¤ë©´ ì¼ì¼ ê¸°ë³¸ ì‹ë¹„ë¥¼ ë°˜í™˜í•˜ëŠ” MealExpense ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

```java
public class PerDiemMealExpenses implements MealExpenses {
   public int getTotal() {
       // ê¸°ë³¸ê°’ìœ¼ë¡œ ì¼ì¼ ê¸°ë³¸ ì‹ë¹„ë¥¼ ë°˜í™˜í•œë‹¤.
       // (ì˜ˆì™¸ê°€ ì•„ë‹Œ)
   }
}

MealExpenses expenses = expenseReportDAO.getMeals(employee.getID());
 m_total += expenses.getTotal();
```



### ğŸ“Œ nullì„ ë°˜í™˜í•˜ì§€ ë§ˆë¼

ë‹¤ìŒì€ í•œì¤„ë§ˆë‹¤ nullì„ í™•ì¸í•˜ëŠ” ì½”ë“œì´ë‹¤.

```java
public void registerItem(Item item) {
	if (item != null) {
		ItemRegistry registry = peristentStore.getItemRegistry();
		if (registry != null) {
			Item existing = registry.getItem(item.getID());
			if (existing.getBillingPeriod().hasRetailOwner()) {
				existing.register(item);
			}
		}
	}
}
```

nullì„ ë°˜í™˜í•˜ëŠ” ì½”ë“œëŠ” ì¼ê±°ë¦¬ë„ ëŠ˜ë¦¬ê³ , í˜¸ì¶œìì—ê²Œ ë¬¸ì œë¥¼ ë– ë„˜ê¸´ë‹¤.  ë‘˜ì§¸ í–‰ì— peristentStore null ì²´í¬ê°€ ë¹ ì¡ŒëŠ”ë° NPEê°€ ë°œìƒë  ìˆ˜ ìˆë‹¤.

ì‚¬ìš©í•˜ë ¤ëŠ” ì™¸ë¶€ APIê°€ nullì„ ë°˜í™˜í•œë‹¤ë©´ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ ì˜ˆì™¸ë¥¼ ë˜ì§€ê±°ë‚˜ íŠ¹ìˆ˜ ì‚¬ë¡€ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ì‹ì„ ê³ ë ¤í•œë‹¤. 

ëŒ€ë¶€ë¶„ì˜ ê²½ìš° **íŠ¹ìˆ˜ ì‚¬ë¡€ ê°ì²´**ê°€ ì†ì‰¬ìš´ í•´ê²°ì±…ì´ë‹¤.

```java
// bad
List<Employee> employees = getEmployees();
if(employees != null) {
	for(Employee e : employees) {
		totalPay += e.getPay();
	}
}

// good
List<Employee> employees = getEmployees();
for(Employee e : employees) {
	totalPay += e.getPay();
}

public List<Employee> getEmployees() {
	if (..ì§ì›ì´ ì—†ë‹¤ë©´..)
		return Collections.emptyList();
}
```



NULL ê°ì²´ íŒ¨í„´ ì°¸ê³  - https://johngrib.github.io/wiki/null-object-pattern/



### ğŸ“Œ nullì„ ì „ë‹¬í•˜ì§€ ë§ˆë¼

ì •ìƒì ì¸ ì¸ìˆ˜ë¡œ nullì„ ê¸°ëŒ€í•˜ëŠ” APIê°€ ì•„ë‹ˆë¼ë©´ ë©”ì„œë“œë¡œ nullì„ ì „ë‹¬í•˜ëŠ” ì½”ë“œëŠ” ìµœëŒ€í•œ í”¼í•œë‹¤.

```java
// bad - Parameterì— nullê°’ì´ ë“¤ì–´ì˜¤ë©´ NullPointerException ë°œìƒ
public class MetricsCalculator {
    public double xProjection(Point p1, Point p2) {
        return (p2.x â€“ p1.x) * 1.5;
    }
}

// bad - InvalidArgumentException ì‚¬ìš©: ìœ„ ë°©ë²•ë³´ë‹¨ ë‚«ë‹¤.. í•˜ì§€ë§Œ ì¢‹ì€ ë°©ë²•ì€ ì•„ë‹˜
public class MetricsCalculator {
    public double xProjection(Point p1, Point p2) {
        if (p1 == null || p2 == null) {
            throw InvalidArgumentException("Invalid argument...");
        }
        return (p2.x â€“ p1.x) * 1.5;
    }
}

// bad - ê°€ë…ì„± ê°œì„ , ì²«ë²ˆì§¸ ì˜ˆì‹œì™€ ê°™ì´ NullPointerException ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ëª»í•œë‹¤.
public class MetricsCalculator {
  public double xProjection(Point p1, Point p2) {
    assert p1 != null : "p1 should not be null";
    assert p2 != null : "p2 should not be null";
    
    return (p2.x â€“ p1.x) * 1.5;
  }
}
```

ê·¸ëƒ¥ nullì„ ë„˜ê¸°ì§€ ëª»í•˜ë„ë¡ ê¸ˆì§€í•˜ëŠ” ì •ì±…ì´ í•©ë¦¬ì ì´ë‹¤.

